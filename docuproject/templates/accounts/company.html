{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | Individual</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="icon" href="{% static 'images/logoremovebg.ico' %}" type="image/ico">
    <link href="https://fonts.googleapis.com/css2?family=Outfit&display=swap" rel="stylesheet">
    <!-- Toastr CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <!-- Sidebar Styles -->
    <style>
      .sidebar {
        background-color: #0a100d;
        color: white;
        min-height: 100vh;
        transition: width 0.3s ease;
        width: 80px;
        overflow-x: hidden;
        flex-shrink: 0;
      }

      .sidebar.expanded {
        width: 250px;
      }

      .sidebar a {
        color: white;
        text-decoration: none;
        display: block;
        padding: 1rem;
        white-space: nowrap;
      }

      .sidebar a:hover {
        background-color: #02c3bd;
        color: #0a100d;
      }

      .sidebar .toggle-btn {
        cursor: pointer;
        padding: 1rem;
        text-align: center;
        background-color: #4f6d7a;
      }

      .sidebar .icon {
        font-size: 1.2rem;
      }

      .sidebar .label {
        display: none;
      }

      .sidebar.expanded .label {
        display: inline;
        margin-left: 1rem;
      }

      #page-content {
        background-color: #e3f8ff;
        min-height: 100vh;
      }
      .sidebar.collapsed a {
        text-align: center;
        }

        .sidebar.collapsed .icon {
          display: inline-block;
          width: 100%;
          text-align: center;
          margin-right: 0;
        }

        .sidebar.collapsed .label {
          display: none;
        }

    </style>
</head>
<body>
{%include "partials/header.html"%}
<div class="d-flex">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar collapsed">
        <div class="toggle-btn" onclick="toggleSidebar()">
          <span class="icon">â˜°</span>
        </div>
            <a href="#"><i class="bi bi-house-door icon"></i><span class="label"> Dashboard</span></a>
            <a href="#"><i class="bi bi-folder icon"></i><span class="label"> My Documents</span></a>
            <a href="#"><i class="bi bi-cloud-arrow-up icon"></i><span class="label"> Upload</span></a>
            <a href="#"><i class="bi bi-share icon"></i><span class="label"> Shared with Me</span></a>
            <a href="#"><i class="bi bi-star icon"></i><span class="label"> Favorites</span></a>
            <a href="#"><i class="bi bi-person-circle icon"></i><span class="label"> Profile</span></a>
            <a href="#"><i class="bi bi-question-circle icon"></i><span class="label"> Help</span></a>
            <a href="#"><i class="bi bi-box-arrow-right icon"></i><span class="label"> Logout</span></a>
    </div>

    <div class= "flex-grow-1 p-4" id= "page-content">
        
        <div class"container-fluid">
                <header class="py-3" style="background-color: #e3f8ff;">
                  <div class="container d-flex justify-content-between align-items-center">
                    <div class="container-fluid d-flex flex-wrap justify-content-center align-items-center text-center my-3">
                      <a href="#" class="m-2 btn btn-sm me-2" style="background-color: #02c3bd; color: #0a100d;">Account Settings</a>
                      <a href="#" class="m-2 btn btn-sm me-2" style="background-color: #02c3bd; color: #0a100d;">Homepage</a>
                      <a href="#" class="m-2 btn btn-sm me-2" style="background-color: #02c3bd; color: #0a100d;">My Package</a>
                      <a href="#" class="m-2 btn btn-sm me-2" style="background-color: #02c3bd; color: #0a100d;">Check Out other packages</a>
                      <a href="#" class="m-2 btn btn-sm btn-outline-light" style="background-color: #0a100d;">Logout</a>
                    </div>

                  </div>
                </header>
                {% if messages %}
                  {% for message in messages %}
                    <script>
                      toastr.success("{{ message }}");
                    </script>
                  {% endfor %}
                {% endif %}
        </div>
        <div class="row g-4">
          <!-- Total Company Documents -->
          <div class="col-md-3">
            <div class="card shadow rounded-2 p-3 d-flex align-items-center text-center">
              <i class="bi bi-folder2-open fs-1 text-primary mb-2"></i>
              <div class="fs-5 fw-semibold">Total Documents</div>
              <div class="fs-4 text-dark">{{ total_documents }}</div>
            </div>
          </div>
        
          <!-- Storage Usage -->
          <div class="col-md-3">
            <div class="card shadow rounded-2 p-3 d-flex align-items-center text-center">
              <i class="bi bi-hdd-network fs-1 text-info mb-2"></i>
              <div class="fs-5 fw-semibold">Storage Used</div>
              <div class="fs-6">{{ used_storage_gb }} GB / {{ total_storage_gb }} GB</div>
              <div class="progress w-100 mt-2" style="height: 8px;">
                <div class="progress-bar bg-info" role="progressbar" style="width: {{ storage_percent }}%;" aria-valuenow="{{ storage_percent }}" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <small class="text-muted mt-1">{{ storage_percent }}% Used</small>
            </div>
          </div>
        
          <!-- Total Employees -->
          <div class="col-md-3">
            <div class="card shadow rounded-2 p-3 d-flex align-items-center text-center">
              <i class="bi bi-people fs-1 text-success mb-2"></i>
              <div class="fs-5 fw-semibold">Employees</div>
              <div class="fs-4 text-dark">{{ employee_count }}</div>
            </div>
          </div>
        
          <!-- Documents This Month -->
          <div class="col-md-3">
            <div class="card shadow rounded-2 p-3 d-flex align-items-center text-center">
              <i class="bi bi-calendar-week fs-1 text-warning mb-2"></i>
              <div class="fs-5 fw-semibold">This Month's Uploads</div>
              <div class="fs-4 text-dark">{{ monthly_uploads }}</div>
            </div>
          </div>
        </div>

        <div class="card mb-4 mt-3 shadow-sm">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Employee Management</h5>
            <a href="#" class="btn btn-light btn-sm">
              <i class="bi bi-person-plus"></i> Add Employee
            </a>
          </div>
          <div class="card-body mt-3">
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Department</th>
                    <th>Uploads</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for employee in employees %}
                  <tr>
                    <td>{{ employee.full_name }}</td>
                    <td>{{ employee.user.email }}</td>
                    <td>{{ employee.department_name }}</td>
                    <td>{{ employee.upload_count }}</td>
                    <td>
                      {% if employee.status %}
                        <span class="badge bg-success">Active</span>
                      {% else %}
                        <span class="badge bg-secondary">Inactive</span>
                      {% endif %}
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm" role="group">
                        <a href="#" class="btn btn-warning"><i class="bi bi-pencil-square"></i></a>
                        <a href="#" class="btn btn-secondary"><i class="bi bi-key"></i></a>
                        <a href="#" class="btn btn-outline-dark">
                          {% if employee.status %}
                            <i class="bi bi-toggle-off"></i>
                          {% else %}
                            <i class="bi bi-toggle-on"></i>
                          {% endif %}
                        </a>
                        <a href="#" class="btn btn-danger"
                           onclick="return confirm('Are you sure you want to delete this employee?');">
                          <i class="bi bi-trash"></i>
                        </a>
                      </div>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="6" class="text-center text-muted">No sub-accounts found.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Document Management -->
        <div class="card mb-4">
          <div class="card-header"><h5>Document Management</h5></div>
          <div class="card-body">
            <div class="row mb-2">
              <div class="col-md-4">
                <select class="form-control"><option>Filter by uploader</option></select>
              </div>
              <div class="col-md-4">
                <select class="form-control"><option>Filter by department</option></select>
              </div>
            </div>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Uploader</th>
                  <th>Department</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for doc in documents %}
                <tr>
                  <td>{{ doc.title }}</td>
                  <td>{{ doc.owner.email }}</td>
                  <td>{{ doc.department }}</td>
                  <td>{{ doc.uploaded_at|date:"Y-m-d" }}</td>
                  <td>
                    <button class="btn btn-sm btn-danger">Delete</button>
                    <button class="btn btn-sm btn-secondary">Share</button>
                  </td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No documents available.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      
        <!-- Department Management -->
        <div class="card mb-4">
          <div class="card-header"><h5>Department Management</h5></div>
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Department</th>
                  <th>Employees</th>
                  <th>Storage Used</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for dept in departments %}
                <tr>
                  <td>{{ dept.name }}</td>
                  <td>{{ dept.employee_count }}</td>
                  <td>{{ dept.storage_used }} MB</td>
                  <td>
                    <button class="btn btn-sm btn-primary">Edit</button>
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </td>
                </tr>
                {% empty %}
                <tr><td colspan="4">No departments created yet.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      
        <!-- Company Profile -->
        <div class="card mb-4">
          <div class="card-header"><h5>Company Profile</h5></div>
          <div class="card-body">
            <p><strong>Company Name:</strong> {{ company.company_name }}</p>
            <p><strong>Website:</strong> {{ company.website }}</p>
            <p><strong>Address:</strong> {{ company.address }}</p>
            <button class="btn btn-primary">Edit Profile</button>
            <button class="btn btn-secondary">Change Password</button>
          </div>
        </div>
      
        <!-- Package & Billing -->
        <div class="card mb-4">
          <div class="card-header"><h5>Package & Billing</h5></div>
          <div class="card-body">
            <p><strong>Current Package:</strong> {{ package.name }}</p>
            <p><strong>Employees Limit:</strong> {{ package.employee_limit }}</p>
            <p><strong>Storage:</strong> {{ package.storage_limit }} MB</p>
            <p><strong>Expiry:</strong> {{ package.expiry_date }}</p>
            <button class="btn btn-warning">Upgrade Package</button>
            <button class="btn btn-info">View Invoices</button>
          </div>
        </div>
      
        <!-- Activity Log -->
        <div class="card mb-4">
          <div class="card-header"><h5>Activity Log</h5></div>
          <div class="card-body">
            <ul class="list-group">
              {% for log in activity_logs %}
              <li class="list-group-item">
                {{ log.timestamp|date:"Y-m-d H:i" }} - {{ log.user }} {{ log.action }}
              </li>
              {% empty %}
              <li class="list-group-item">No recent activity.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      
        <!-- Notifications Center -->
        <div class="card mb-4">
          <div class="card-header"><h5>Notifications</h5></div>
          <div class="card-body">
            <ul class="list-group">
              {% for note in notifications %}
              <li class="list-group-item">{{ note.message }}</li>
              {% empty %}
              <li class="list-group-item">No notifications at this time.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      
        <!-- Quick Actions -->
        <div class="card mb-5">
          <div class="card-header"><h5>Quick Actions</h5></div>
          <div class="card-body d-flex flex-wrap gap-2">
            <button class="btn btn-outline-primary">Upload File</button>
            <button class="btn btn-outline-success">Add Sub-account</button>
            <button class="btn btn-outline-dark">View Audit Log</button>
            <button class="btn btn-outline-warning">Share Document</button>
          </div>
        </div>
      </div>
            <!-- ðŸŸ© Floating Notifications Button -->
            <button class="btn btn-info position-fixed bottom-0 end-0 m-4 rounded-circle" title="View Notifications"
                    onclick="toastr.info('No new notifications')">
              <i class="bi bi-bell-fill fs-4"></i>
            </button>

            
        </div>
      </div>
    </div>
</div>
<!-- Sidebar Toggle Script -->
<script>
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('expanded');
    sidebar.classList.toggle('collapsed');
  }
</script>
<!-- Toastr Notifications -->
<script>
  toastr.options = {
    "positionClass": "toast-bottom-right",
    "timeOut": "4000"
  };
  {% if messages %}
    {% for message in messages %}
      toastr["{{ message.tags }}"]("{{ message }}");
    {% endfor %}
  {% endif %}
</script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const fileTypeCtx = document.getElementById('fileTypeChart');
  const activityCtx = document.getElementById('activityChart');

  new Chart(fileTypeCtx, {
    type: 'doughnut',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        data: {{ chart_data|safe }},
        backgroundColor: ['#02c3bd', '#4f6d7a', '#9cffff', '#e3f8ff']
      }]
    }
  });

  new Chart(activityCtx, {
    type: 'line',
    data: {
      labels: {{ activity_labels|safe }},
      datasets: [{
        label: 'Uploads',
        data: {{ activity_data|safe }},
        borderColor: '#02c3bd',
        tension: 0.3
      }]
    }
  });
</script>
<!-- Toast Example (Toastr) -->
<script>
  toastr.options = {
    "positionClass": "toast-bottom-right",
  }
  {% if messages %}
    {% for message in messages %}
      toastr["{{ message.tags }}"]("{{ message }}");
    {% endfor %}
  {% endif %}
</script>
</body>
</html>